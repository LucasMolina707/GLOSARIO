<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Biblioteca Â· Uâ€‘Code</title>
  <meta name="description" content="Biblioteca de PDFs con visor tipo libro." />
  <style>
    :root{
      --bg:#0b0c10; --panel:#11141b; --panel2:#151926; --fg:#f2f3f5; --muted:#b9c0ce; --accent:#6ee7b7;
      --card:#0f1218; --border:rgba(255,255,255,.08);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 600px at 50% -10%, #1b1f28 0%, var(--bg) 60%);
      color:var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, 'Helvetica Neue', Arial, 'Noto Sans';
      display:flex; flex-direction:column;
    }
    header{
      position:sticky; top:0; z-index:50;
      background: rgba(16,18,24,.65); border-bottom:1px solid var(--border); backdrop-filter: blur(8px);
      padding:12px 14px; display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    h1{font-size:18px; margin:0; letter-spacing:.2px;}
    .muted{color:var(--muted); font-size:12px}
    .toolbar{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .input, .select{
      background: rgba(255,255,255,.06); color:var(--fg); border:1px solid var(--border);
      padding:8px 10px; border-radius:12px; outline:none; min-width:0;
    }
    .input{width:220px; max-width:60vw}
    .btn{
      appearance:none; border:1px solid var(--border); background: rgba(255,255,255,.06);
      color:var(--fg); padding:8px 12px; border-radius:12px; cursor:pointer; font-weight:600;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
    }
    .btn:hover{ background: rgba(255,255,255,.1); border-color: rgba(255,255,255,.24); }
    main{padding:16px;}
    .grid{
      display:grid; gap:14px;
      grid-template-columns: repeat( auto-fill, minmax(220px, 1fr) );
    }
    .card{
      background: var(--card); border:1px solid var(--border); border-radius:16px; overflow:hidden;
      display:flex; flex-direction:column; min-height:160px;
      transition: transform .08s ease, box-shadow .2s ease;
    }
    .card:hover{ transform: translateY(-2px); box-shadow:0 18px 40px rgba(0,0,0,.35); }
    .thumb{
      display:grid; place-items:center; height:140px; background: var(--panel2);
      border-bottom:1px solid var(--border);
    }
    .pdf-icon{font-size:46px; opacity:.9}
    .content{padding:10px 12px; display:flex; flex-direction:column; gap:6px}
    .title{font-weight:700; line-height:1.3}
    .meta{font-size:12px; color:var(--muted)}
    .grow{flex:1}
    .row{display:flex; gap:8px; align-items:center; justify-content:space-between}
    .status{font-size:12px; color:var(--muted)}
    .footer{
      padding:10px 12px; display:flex; justify-content:center; color:var(--muted); border-top:1px solid var(--border);
      background: rgba(255,255,255,.03);
    }
    a.cardlink{ color:inherit; text-decoration:none }
    .hidden{display:none !important}
  </style>
  <script defer src="config.js"></script>
</head>
<body>
  <header>
    <div>
      <h1>Biblioteca de PDFs Â· Uâ€‘Code</h1>
      <div class="muted">Selecciona un documento para abrirlo en el visor tipo libro.</div>
    </div>
    <div class="toolbar">
      <input class="input" id="search" type="search" placeholder="Buscar por nombreâ€¦" />
      <select class="select" id="sort">
        <option value="name-asc">Nombre Aâ†’Z</option>
        <option value="name-desc">Nombre Zâ†’A</option>
        <option value="size-desc">TamaÃ±o mayor</option>
        <option value="size-asc">TamaÃ±o menor</option>
      </select>
      <button class="btn" id="reload">Recargar</button>
    </div>
  </header>

  <main>
    <div id="status" class="status">Cargandoâ€¦</div>
    <div id="grid" class="grid"></div>
  </main>

  <div class="footer">Uâ€‘Code Â· Biblioteca</div>

  <script>
    const grid = document.getElementById('grid');
    const statusEl = document.getElementById('status');
    const searchEl = document.getElementById('search');
    const sortEl = document.getElementById('sort');
    const reloadBtn = document.getElementById('reload');

    function fmtBytes(bytes){
      if(bytes === undefined || bytes === null) return '';
      const units = ['B','KB','MB','GB']; let i=0; let num=bytes;
      while(num >= 1024 && i < units.length-1){ num/=1024; i++; }
      return num.toFixed(num<10?2:num<100?1:0) + ' ' + units[i];
    }

    function buildViewerUrl(src, title){
      const u = new URL('viewer.html', location.href);
      u.searchParams.set('src', src);
      if(title) u.searchParams.set('title', title);
      return u.toString();
    }

    function renderList(items){
      grid.innerHTML = '';
      if(!items || !items.length){
        statusEl.textContent = 'No se encontraron PDFs en la carpeta.';
        return;
      }
      statusEl.textContent = '';
      for(const it of items){
        const a = document.createElement('a');
        a.className = 'cardlink';
        a.href = buildViewerUrl(it.src, it.title || it.name);
        a.innerHTML = `
          <article class="card">
            <div class="thumb"><div class="pdf-icon">ðŸ“„</div></div>
            <div class="content">
              <div class="title">${(it.title||it.name||'Documento PDF').replace(/</g,'&lt;')}</div>
              <div class="row meta">
                <span>${fmtBytes(it.size)}</span>
                <span>${it.path||''}</span>
              </div>
            </div>
          </article>
        `;
        grid.appendChild(a);
      }
    }

    function applySearchAndSort(raw){
      const q = searchEl.value.trim().toLowerCase();
      let arr = [...raw];
      if(q){
        arr = arr.filter(x => (x.title||x.name||'').toLowerCase().includes(q));
      }
      const sort = sortEl.value;
      arr.sort((a,b)=>{
        switch(sort){
          case 'name-asc': return (a.title||a.name).localeCompare(b.title||b.name);
          case 'name-desc': return (b.title||b.name).localeCompare(a.title||a.name);
          case 'size-asc': return (a.size||0) - (b.size||0);
          case 'size-desc': return (b.size||0) - (a.size||0);
        }
        return 0;
      });
      renderList(arr);
    }

    let cacheItems = [];

    async function loadFromManual(){
      const items = (window.MANUAL_PDFS||[]).map(x=>({ 
        title: x.title || x.name,
        name: x.name || x.title,
        src: x.url,
        size: x.size || null,
        path: x.path || ''
      }));
      cacheItems = items;
      applySearchAndSort(cacheItems);
    }

    async function load(){
      grid.innerHTML=''; statusEl.textContent='Cargandoâ€¦';
      await loadFromManual();
    }

    searchEl.addEventListener('input', ()=>applySearchAndSort(cacheItems));
    sortEl.addEventListener('change', ()=>applySearchAndSort(cacheItems));
    reloadBtn.addEventListener('click', load);

    document.addEventListener('DOMContentLoaded', load);
  </script>
</body>
</html>
